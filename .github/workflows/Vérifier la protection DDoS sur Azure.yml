name: Check Azure DDoS
on: [push]

jobs:
  check-network:
    runs-on: ubuntu-latest
    steps:
      - name: Connexion √† Azure
        uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}

      - name: V√©rifier la protection DDoS
        shell: /usr/bin/bash -e
        run: |
          # Variables bas√©es sur tes captures d'√©cran
          RG_NAME="weave-team"
          
          echo "üîç Recherche de r√©seaux virtuels dans le groupe : $RG_NAME"
          
          # R√©cup√®re le nom du premier VNet trouv√©
          VNET_NAME=$(az network vnet list --resource-group "$RG_NAME" --query "[0].name" -o tsv)
          
          if [ -z "$VNET_NAME" ]; then
            echo "‚ö†Ô∏è  INFO : Aucun VNet trouv√© dans le groupe '$RG_NAME'."
            echo "Note : Vos services (App Service/DB) utilisent l'acc√®s public et n'ont pas de VNet d√©di√©."
            exit 0
          fi
          
          echo "‚úÖ VNet d√©tect√© : $VNET_NAME"
          
          # V√©rification du statut
          ddos_status=$(az network vnet show --name "$VNET_NAME" --resource-group "$RG_NAME" --query "enableDdosProtection" -o tsv)
          
          if [ "$ddos_status" != "true" ]; then
            echo "‚ùå ERREUR : La protection DDoS n'est pas activ√©e sur $VNET_NAME."
            exit 1
          else
            echo "üõ°Ô∏è  SUCC√àS : La protection DDoS est active."
          fi
