- name: V√©rifier la protection DDoS sur Azure
      run: |
        RG_NAME="weave-team"
        
        echo "üîç Recherche de VNets dans le groupe de ressources : $RG_NAME"
        
        # R√©cup√®re la liste des VNets
        VNET_LIST=$(az network vnet list --resource-group "$RG_NAME" --query "[].name" -o tsv)
        
        if [ -z "$VNET_LIST" ]; then
          echo "‚ö†Ô∏è INFO : Aucun VNet trouv√© dans $RG_NAME."
          echo "La protection DDoS ne s'applique qu'aux VNets. Vos services (App Service/DB) sont actuellement en acc√®s public."
          exit 0 # On met 0 pour ne pas bloquer le pipeline, ou 1 si tu veux forcer la cr√©ation d'un VNet
        fi

        for VNET in $VNET_LIST; do
          echo "üßê V√©rification de : $VNET"
          status=$(az network vnet show --name "$VNET" --resource-group "$RG_NAME" --query "enableDdosProtection" -o tsv)
          
          if [ "$status" = "true" ]; then
            echo "‚úÖ DDoS Protection active sur $VNET"
          else
            echo "‚ùå DDoS Protection d√©sactiv√©e sur $VNET"
            exit 1
          fi
        done
      shell: /usr/bin/bash -e
