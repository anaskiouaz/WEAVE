- name: Audit de S√©curit√© Base de Donn√©es
      shell: /usr/bin/bash -e
      run: |
        RG="weave-team"
        DB_SERVER="weave-db-server"

        echo "üîç Analyse du serveur : $DB_SERVER"

        # 1. V√©rification de l'Acc√®s Public
        public_access=$(az postgres flexible-server show --resource-group $RG --name $DB_SERVER --query "network.publicNetworkAccess" -o tsv)
        if [ "$public_access" == "Enabled" ]; then
          echo "‚ö†Ô∏è  ALERTE : L'acc√®s public est activ√©. V√©rifiez que seules vos IPs sont autoris√©es."
        fi

        # 2. V√©rification de la version TLS (Minimum 1.2 recommand√©)
        tls_version=$(az postgres flexible-server parameter show --resource-group $RG --server-name $DB_SERVER --name "minimal_tls_version" --query "value" -o tsv)
        echo "üîí Version TLS minimale : $tls_version"

        # 3. V√©rification de la Haute Disponibilit√© (HA)
        ha_status=$(az postgres flexible-server show --resource-group $RG --name $DB_SERVER --query "highAvailability.mode" -o tsv)
        if [ "$ha_status" == "Disabled" ]; then
          echo "‚ÑπÔ∏è  INFO : Haute disponibilit√© d√©sactiv√©e (Normal pour le mode Burstable/√âtudiant)."
        fi

        # 4. V√©rification du Backup (R√©tention)
        backup_days=$(az postgres flexible-server show --resource-group $RG --name $DB_SERVER --query "backup.backupRetentionDays" -o tsv)
        echo "üíæ R√©tention des sauvegardes : $backup_days jours."
